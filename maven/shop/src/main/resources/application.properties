# ========== 原有核心配置（完全保留） ==========
spring.application.name=shop

# 数据库配置
spring.datasource.url=jdbc:mysql://mysql-server:3306/shop_db?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
spring.datasource.username=shop_app_user
spring.datasource.password=123456
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# MyBatis配置
mybatis.mapper-locations=classpath:mapper/*.xml
mybatis.configuration.map-underscore-to-camel-case=true
mybatis.type-aliases-package=com.example.shop.entity

spring.sql.init.dependency-detection=none

# 编码配置
logging.charset.console=UTF-8
logging.charset.file=UTF-8
server.tomcat.uri-encoding=UTF-8

# ========== 新增：文件上传大小限制（解决图片上传过大问题） ==========
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=20MB

# ========== 修复：静态资源映射（关键修改2行） ==========
# 1. 指定前端访问前缀为/uploads/**（匹配你生成的图片相对路径）
spring.mvc.static-path-pattern=/uploads/**
# 2. 静态资源目录改为/opt/shop_uploads/（去掉末尾的products/，让拼接后路径匹配）
spring.web.resources.static-locations=classpath:/static/,file:/opt/shop_uploads/

# ========== 新增：自定义图片上传本地路径（和代码中@Value("${upload.path}")对应） ==========
# Windows系统路径（注意：properties中路径用\\或/，推荐用/）
# upload.path=D:/shop_uploads/products/
# Linux/Mac系统路径（部署服务器时替换）
upload.path=/opt/shop_uploads/products/

# ========== 新增：邮件（SMTP）配置示例 ==========
# 注意：不要在源码中提交真实凭据；建议通过环境变量注入 MAIL_USERNAME 和 MAIL_PASSWORD
spring.mail.host=smtp.163.com
spring.mail.port=465
spring.mail.username=${MAIL_USERNAME:}
spring.mail.password=${MAIL_PASSWORD:}
spring.mail.protocol=smtp
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.ssl.enable=true

# 调试与增强超时设置（用于排查连接/认证问题）
spring.mail.properties.mail.smtp.connectiontimeout=20000
spring.mail.properties.mail.smtp.timeout=20000
spring.mail.properties.mail.smtp.writetimeout=20000
spring.mail.properties.mail.debug=true
logging.level.org.springframework.mail=DEBUG
spring.mail.properties.mail.smtp.ssl.trust=smtp.163.com
spring.mail.default-encoding=UTF-8

# 可选：测试连接（true 时启动时会尝试连接 SMTP）
spring.mail.test-connection=false